plugins {
    id 'jacoco'
    id 'java'
    id 'org.owasp.dependencycheck' version '6.1.4'
    id 'org.sonarqube' version '3.1.1'
}

allprojects {
    sourceCompatibility = '11'
    targetCompatibility = '11'
}


// https://jeremylong.github.io/DependencyCheck/dependency-check-gradle/configuration.html
dependencyCheck {
    // Specifies if the build should be failed if a CVSS score above a specified level is identified.
    // range of 0-10 fails the build, anything greater and it doesn't fail the build
    failBuildOnCVSS = System.getProperty('dependencyCheck.failBuild') == 'true' ? 0 : 11
    suppressionFile = 'config/owasp/suppressions.xml'
    outputDirectory = 'build/reports/'

    analyzers {
        // Disable scanning of .NET related binaries
        assemblyEnabled = false
    }
}

project.tasks['sonarqube'].dependsOn jacocoTestReport

def sonarExclusions = [
        '**/uk/gov/hmcts/reform/divorce/ccd/model/**',
        '**/uk/gov/hmcts/reform/divorce/caseapi/model/**'
]

sonarqube {
    properties {
        property "sonar.projectName", "Reform :: nfdiv-case-api"
        property "sonar.projectKey", "uk.gov.hmcts.reform:nfdiv-case-api"
        property "sonar.coverage.jacoco.xmlReportPaths", "${projectDir}/ccd-definitions/build/reports/jacoco/test/jacocoTestReport.xml,${projectDir}/api/build/reports/jacoco/test/jacocoTestReport.xml"
        property "sonar.exclusions", sonarExclusions.join(', ')
    }
}
